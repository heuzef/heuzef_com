<!doctype html>
<html lang="fr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Heuzef</title>
  <link rel="canonical" href="https://heuzef.com/notes/generer-ses-diagrammes-avec-python/index.html">

    <link rel="apple-touch-icon" href="https://heuzef.com/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="https://heuzef.com/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://heuzef.com/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://heuzef.com/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://heuzef.com/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/pygments/manni.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://heuzef.com/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://heuzef.com/feeds/informatique.atom.xml">  
  <meta name="description" content="Dans cet article, nous allons nous initier au DaC afin de rÃ©aliser de magnifiques schÃ©mas en Python. Aujourdâ€™hui, il est assez tentant de sâ€™orienter vers des solutions comme Draw.io pour rÃ©aliser des schÃ©mas visuellement agrÃ©able, mais lâ€™outil en lui-mÃªme ne me convient pas, car je ne â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://heuzef.com/">
        <img class="img-fluid rounded" src=https://heuzef.com/assets/logo_heuzef_hd.png alt="Heuze Florent">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://heuzef.com/">Heuze Florent</a></h1>
      <p class="text-muted">
Les notes excentriques d'un bidouilleur.
</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://cv.heuzef.com" target="_blank"><i class="fa fa-file"></i> mon cv</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://heuzef.com/contact.html">Contact</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/heuzef/" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-git" href="https://github.com/heuzef" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-heartbeat" href="https://status.heuzef.com" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-map" href="https://network.heuzef.com" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="https://heuzef.com/feeds/all.atom.xml" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  GÃ©nÃ©rer ses diagrammes avec&nbsp;Python
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2023-08-23T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          Wed 23 August 2023
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="https://heuzef.com/category/informatique/">Informatique</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="https://heuzef.com/tag/python/">#python</a>,               <a href="https://heuzef.com/tag/autohebergement/">#autohÃ©bergement</a>,               <a href="https://heuzef.com/tag/web/">#web</a>,               <a href="https://heuzef.com/tag/diagramme/">#diagramme</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Dans cet article, nous allons nous initier au <abbr title="Diagrams as Code">DaC</abbr> afin de rÃ©aliser de magnifiques schÃ©mas enÂ Python.</p>
<p>Aujourdâ€™hui, il est assez tentant de sâ€™orienter vers des solutions comme Draw.io pour rÃ©aliser des schÃ©mas visuellement agrÃ©able, mais lâ€™outil en lui-mÃªme ne me convient pas, car je ne le trouve pas assez flexible. Je souhaite utiliser un outil libre sans restriction et qui permet de gÃ©nÃ©rer confortablement (voir automatiquement) des beaux schÃ©mas que je peux exporter en <span class="caps">SVG</span> et <span class="caps">PDF</span> Ã  laÂ demande.</p>
<p><img alt="Diagrams" class="img-fluid" src="../../assets/diagrams.png"/></p>
<h1>Pourquoi utiliser du <abbr title="Diagrams as Code">DaC</abbr> ?Â ğŸ¤”</h1>
<p>Pour lâ€™Ã©volution des schÃ©mas dans le temps, il devient alors trÃ¨s usant de ressortir son logiciel pour Ã©diter proprement pour une simple mise Ã Â jour.</p>
<p>En tant que Graphiste, il mâ€™est difficile de ne pas Ãªtre perfectionniste et la moindre mise Ã  jour prend alors beaucoup trop de temps pour avoir un rendu satisfaisant.
Changer de logique pour le <abbr title="Diagrams as Code">DaC</abbr> permet donc de ne plus du tout sortir de logiciel de <span class="caps">PAO</span>, mais de simplement tout coder. En plus dâ€™Ãªtre une solution lÃ©gÃ¨re, il est alors agrÃ©able de revenir dans le code pour actualiser son schÃ©ma. CouplÃ© avec du versionnage, câ€™est encore plus plaisant Ã Â maintenir.</p>
<h1>Recherche dâ€™outilÂ ğŸ”</h1>
<p>Jâ€™ai mis du temps Ã  trouver mon bonheur, entre les vieux projets dÃ©prÃ©ciÃ©s de geek frustrÃ©s difficile Ã  exploiter, puis je suis tombÃ© sur la rÃ©fÃ©rence, Ã  savoir <a href="https://kroki.io">Kroki.io</a> qui convient Ã  beaucoup, car bien maintenu et dispose de tout un tas de librairie populaire â€¦ mais câ€™est tout ! TrÃ¨s efficace pour gÃ©nÃ©rer automatiquement des diagrammes, il nâ€™offre cependant pas la flexibilitÃ© pour rÃ©aliser lâ€™effet visuel â€œwahouâ€ que je cherche ni laÂ simplicitÃ©.</p>
<p>Jâ€™ai bien Ã©videment trouvÃ© la pÃ©pite, câ€™est pour Ã§a que je fait cette note ğŸ˜œ.
Voici donc comment prendre en main <a href="https://diagrams.mingrammer.com/"><span class="caps">DIAGRAMS</span></a> deÂ Mingrammer.</p>
<h1>Fonctionnement de DiagramsÂ âš™ï¸</h1>
<p>Le principe dâ€™utilisation est au plus efficace, le schÃ©ma est sous forme dâ€™un fichier Python (.py)Â :</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Diagram</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">EC2</span>

<span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">"Simple Diagram"</span><span class="p">):</span>
    <span class="n">EC2</span><span class="p">(</span><span class="s2">"web"</span><span class="p">)</span>
</code></pre></div>
<p>Il permet de gÃ©nÃ©rer le rendu dâ€™une simple commandeÂ :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>diagram.py
</code></pre></div>
<p>Et paf, nous voici avec une imageÂ !</p>
<p>Voici un exemple un peu plus complexeÂ :</p>
<p><img alt="Diagrams" class="img-fluid" src="../../assets/dac.jpg"/></p>
<h1>InstallationÂ ğŸ”§</h1>
<p>En utilisant son gestionnaire de paquet prÃ©fÃ©rÃ© pour dÃ©ployer Python, Pip, Graphiz et Inkscape (sera utile pour la suite), par exemple sur une base <span class="caps">RHEL</span>Â :</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>python3<span class="w"> </span>python3-pip<span class="w"> </span>graphviz<span class="w"> </span>inkscape
pip3<span class="w"> </span>install<span class="w"> </span>diagrams
</code></pre></div>
<p>TerminÃ©, aller bisous Ã  la famille, nâ€™oublie pas de nourrir le chien, ciao. Jâ€™aime bien Ã§a moi, quand Ã§a ne rÃ©clame pas la mise en place dâ€™une usine Ã  gazÂ âœŒï¸</p>
<p>Il est possible de lâ€™installer sur dâ€™autres <span class="caps">OS</span> comme Windows et MacOS siÂ besoin.</p>
<p>Pour son utilisation avancÃ©e, lâ€™outil est trÃ¨s bien documentÃ© et vous fournit pas mal dâ€™exemple et surtout un guide pour vous expliquer les 3 grands principes, quâ€™il faut interprÃ©ter sur votre schÃ©ma ainsiÂ :</p>
<ul>
<li>Nodes : Enssemble de ressourcesÂ importÃ©s</li>
<li>Clusters : GroupeÂ dâ€™Ã©lÃ©ments</li>
<li>Edges : Les liaisons entre lesÂ Ã©lÃ©ments</li>
</ul>
<p>Ce qui est pratique avec les Nodes, câ€™est quâ€™ils sont basÃ© sur des technologies existantes populaires (<span class="caps">AWS</span>, Azure, etc â€¦) pour un joli renduÂ immÃ©diat.</p>
<p><i class="fa fa-book"></i> <a href="https://diagrams.mingrammer.com/docs/getting-started/installation">consulter la documentation</a>.</p>
<h1>Utilisation de ses propres iconesÂ ğŸ˜</h1>
<p>Voici le point le plus intÃ©ressant, utiliser ses propres icÃ´nes pour un maximum de flexibilitÃ© avec le Node <strong>Custom</strong>.</p>
<p>Si vous Ãªtes Ã  la recherche dâ€™un pack dâ€™icÃ´nes <span class="caps">SVG</span> pour rÃ©aliser un schÃ©ma rÃ©seau, vous pouvez tous simplement rÃ©cupÃ©rer ceux de Microsoft Azure qui sont trÃ¨s cool en clonant simplement ce dÃ©pÃ´tÂ :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/benc-uk/icon-collection.git
</code></pre></div>
<p>GrÃ¢ce Ã  Inkscape, vous pouvez convertir les images directement dans une taille et format exploitable pour Diagrams pour un rendu de qualitÃ©, par exempleÂ :</p>
<div class="highlight"><pre><span></span><code>inkscape<span class="w"> </span>-w<span class="w"> </span><span class="m">1024</span><span class="w"> </span>-h<span class="w"> </span><span class="m">1024</span><span class="w"> </span>icon-collection/azure-patterns/server.svg<span class="w"> </span>-o<span class="w"> </span>icons/server.png
</code></pre></div>
<p>Maintenant, que nos icÃ´nes sont prÃªtes et stockÃ©s dans un dossier (â€œiconsâ€ dans mon cas), il ne reste plus quâ€™Ã  invoquer tout Ã§a dans sonÂ script.</p>
<h1>Mise en applicationÂ ğŸ‘·</h1>
<p>Voici maintenant comment initier un script Python avec icÃ´nes personnalisÃ©es (et ma configuration maison en bonus)Â :</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Importation des dÃ©pendances</span>
from<span class="w"> </span>diagrams<span class="w"> </span>import<span class="w"> </span>Diagram,<span class="w"> </span>Cluster,<span class="w"> </span>Edge
from<span class="w"> </span>diagrams.custom<span class="w"> </span>import<span class="w"> </span>Custom
from<span class="w"> </span>datetime<span class="w"> </span>import<span class="w"> </span>datetime
<span class="nv">today</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>datetime.today<span class="o">()</span>

<span class="c1"># Ici la configuration :</span>
<span class="c1"># Le titre du schÃ©ma avec la date de gÃ©nÃ©ration,</span>
<span class="c1"># le nom de fichier de sortie avec les formats Ã  gÃ©nÃ©rer,</span>
<span class="c1"># la direction d'affichage</span>
<span class="c1"># https://www.graphviz.org/documentation</span>
with<span class="w"> </span>Diagram<span class="o">(</span><span class="s2">"Mon schÃ©ma - %s"</span><span class="w"> </span>%<span class="w"> </span>today.strftime<span class="o">(</span><span class="s1">'%d/%m/%Y %H:%M'</span><span class="o">)</span><span class="w"> </span>,<span class="w"> </span><span class="nv">show</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">filename</span><span class="o">=</span><span class="s2">"schema"</span>,<span class="w"> </span><span class="nv">outformat</span><span class="o">=[</span><span class="s2">"png"</span>,<span class="w"> </span><span class="s2">"jpg"</span>,<span class="w"> </span><span class="s2">"svg"</span>,<span class="w"> </span><span class="s2">"pdf"</span>,<span class="w"> </span><span class="s2">"dot"</span><span class="o">]</span>,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span><span class="s2">"TB"</span><span class="o">)</span>:

<span class="w">  </span><span class="c1"># Icones personalisÃ©s</span>
<span class="w">  </span><span class="nv">internet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"Serveur"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span><span class="c1"># Groupes</span>
<span class="w">  </span>with<span class="w"> </span>Cluster<span class="o">(</span><span class="s2">"Zone LAN \n VLAN 1 \n DHCP : 192.168.1.1-99"</span><span class="o">)</span>:
<span class="w">      </span><span class="nv">HOME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"192.168.1.0/24"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span>with<span class="w"> </span>Cluster<span class="o">(</span><span class="s2">"Zone DMZ \n VLAN 100 \n DHCP : 192.168.100.1-99"</span><span class="o">)</span>:
<span class="w">    </span><span class="nv">DMZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"192.168.100.0/24"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span><span class="c1"># Liens</span>
<span class="w">  </span>internet<span class="w"> </span>&gt;&gt;<span class="w"> </span>Edge<span class="o">(</span><span class="nv">color</span><span class="o">=</span><span class="s2">"red"</span>,<span class="w"> </span><span class="nv">label</span><span class="o">=</span><span class="s2">"FTTH"</span>,<span class="w"> </span><span class="nv">style</span><span class="o">=</span><span class="s2">"bold"</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>DMZ
</code></pre></div>
<p>Voici pour le concret, je vous invite Ã  voir le schÃ©ma complet que je partage de mon propre rÃ©seau domestique Ã  lâ€™adresse <a href="https://network.heuzef.com"><i class="fa fa-map"></i> network.heuzef.com</a>.
Le code Python de mon schÃ©ma y est disponible au tÃ©lÃ©chargement pour vous aider Ã  apprivoiserÂ lâ€™outil.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://heuzef.com/index.html"><i class="fa fa-home"></i> Accueil</a></li>
    <li class="list-inline-item"><a href="https://heuzef.com/categories.html"><i class="fa fa-cubes"></i> CatÃ©gories</a></li>
    <li class="list-inline-item"><a href="https://heuzef.com/tags.html"><i class="fa fa-tags"></i> Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    GÃ©nÃ©rÃ© avec <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
    / <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  </p>
</div>    </div>
  </footer>

</body>

</html>