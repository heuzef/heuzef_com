<!doctype html>
<html lang="fr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Heuzef</title>
  <link rel="canonical" href="https://heuzef.com/notes/generer-ses-diagrammes-avec-python/index.html">

    <link rel="apple-touch-icon" href="https://heuzef.com/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="https://heuzef.com/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://heuzef.com/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://heuzef.com/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://heuzef.com/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/pygments/manni.min.css">
  <link rel="stylesheet" href="https://heuzef.com/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://heuzef.com/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://heuzef.com/feeds/informatique.atom.xml">  
  <meta name="description" content="Dans cet article, nous allons nous initier au DaC afin de réaliser de magnifiques schémas en Python. Aujourd’hui, il est assez tentant de s’orienter vers des solutions comme Draw.io pour réaliser des schémas visuellement agréable, mais l’outil en lui-même ne me convient pas, car je ne …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://heuzef.com/">
        <img class="img-fluid rounded" src=https://heuzef.com/assets/logo_heuzef_hd.png alt="Heuze Florent">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://heuzef.com/">Heuze Florent</a></h1>
      <p class="text-muted">
Les notes excentriques d'un bidouilleur.
</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://cv.heuzef.com" target="_blank"><i class="fa fa-file"></i> mon cv</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://heuzef.com/contact.html">Contact</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/heuzef/" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-git" href="https://github.com/heuzef" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-heartbeat" href="https://status.heuzef.com" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-map" href="https://network.heuzef.com" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="https://heuzef.com/feeds/all.atom.xml" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Générer ses diagrammes avec&nbsp;Python
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2023-08-23T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          Wed 23 August 2023
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="https://heuzef.com/category/informatique/">Informatique</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="https://heuzef.com/tag/python/">#python</a>,               <a href="https://heuzef.com/tag/autohebergement/">#autohébergement</a>,               <a href="https://heuzef.com/tag/web/">#web</a>,               <a href="https://heuzef.com/tag/diagramme/">#diagramme</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Dans cet article, nous allons nous initier au <abbr title="Diagrams as Code">DaC</abbr> afin de réaliser de magnifiques schémas en Python.</p>
<p>Aujourd’hui, il est assez tentant de s’orienter vers des solutions comme Draw.io pour réaliser des schémas visuellement agréable, mais l’outil en lui-même ne me convient pas, car je ne le trouve pas assez flexible. Je souhaite utiliser un outil libre sans restriction et qui permet de générer confortablement (voir automatiquement) des beaux schémas que je peux exporter en <span class="caps">SVG</span> et <span class="caps">PDF</span> à la demande.</p>
<p><img alt="Diagrams" class="img-fluid" src="../../assets/diagrams.png"/></p>
<h1>Pourquoi utiliser du <abbr title="Diagrams as Code">DaC</abbr> ? 🤔</h1>
<p>Pour l’évolution des schémas dans le temps, il devient alors très usant de ressortir son logiciel pour éditer proprement pour une simple mise à jour.</p>
<p>En tant que Graphiste, il m’est difficile de ne pas être perfectionniste et la moindre mise à jour prend alors beaucoup trop de temps pour avoir un rendu satisfaisant.
Changer de logique pour le <abbr title="Diagrams as Code">DaC</abbr> permet donc de ne plus du tout sortir de logiciel de <span class="caps">PAO</span>, mais de simplement tout coder. En plus d’être une solution légère, il est alors agréable de revenir dans le code pour actualiser son schéma. Couplé avec du versionnage, c’est encore plus plaisant à maintenir.</p>
<h1>Recherche d’outil 🔍</h1>
<p>J’ai mis du temps à trouver mon bonheur, entre les vieux projets dépréciés de geek frustrés difficile à exploiter, puis je suis tombé sur la référence, à savoir <a href="https://kroki.io">Kroki.io</a> qui convient à beaucoup, car bien maintenu et dispose de tout un tas de librairie populaire … mais c’est tout ! Très efficace pour générer automatiquement des diagrammes, il n’offre cependant pas la flexibilité pour réaliser l’effet visuel “wahou” que je cherche ni la simplicité.</p>
<p>J’ai bien évidement trouvé la pépite, c’est pour ça que je fait cette note 😜.
Voici donc comment prendre en main <a href="https://diagrams.mingrammer.com/"><span class="caps">DIAGRAMS</span></a> de Mingrammer.</p>
<h1>Fonctionnement de Diagrams ⚙️</h1>
<p>Le principe d’utilisation est au plus efficace, le schéma est sous forme d’un fichier Python (.py) :</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Diagram</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">EC2</span>

<span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">"Simple Diagram"</span><span class="p">):</span>
    <span class="n">EC2</span><span class="p">(</span><span class="s2">"web"</span><span class="p">)</span>
</code></pre></div>
<p>Il permet de générer le rendu d’une simple commande :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>diagram.py
</code></pre></div>
<p>Et paf, nous voici avec une image !</p>
<p>Voici un exemple un peu plus complexe :</p>
<p><img alt="Diagrams" class="img-fluid" src="../../assets/dac.jpg"/></p>
<h1>Installation 🔧</h1>
<p>En utilisant son gestionnaire de paquet préféré pour déployer Python, Pip, Graphiz et Inkscape (sera utile pour la suite), par exemple sur une base <span class="caps">RHEL</span> :</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>python3<span class="w"> </span>python3-pip<span class="w"> </span>graphviz<span class="w"> </span>inkscape
pip3<span class="w"> </span>install<span class="w"> </span>diagrams
</code></pre></div>
<p>Terminé, aller bisous à la famille, n’oublie pas de nourrir le chien, ciao. J’aime bien ça moi, quand ça ne réclame pas la mise en place d’une usine à gaz ✌️</p>
<p>Il est possible de l’installer sur d’autres <span class="caps">OS</span> comme Windows et MacOS si besoin.</p>
<p>Pour son utilisation avancée, l’outil est très bien documenté et vous fournit pas mal d’exemple et surtout un guide pour vous expliquer les 3 grands principes, qu’il faut interpréter sur votre schéma ainsi :</p>
<ul>
<li>Nodes : Enssemble de ressources importés</li>
<li>Clusters : Groupe d’éléments</li>
<li>Edges : Les liaisons entre les éléments</li>
</ul>
<p>Ce qui est pratique avec les Nodes, c’est qu’ils sont basé sur des technologies existantes populaires (<span class="caps">AWS</span>, Azure, etc …) pour un joli rendu immédiat.</p>
<p><i class="fa fa-book"></i> <a href="https://diagrams.mingrammer.com/docs/getting-started/installation">consulter la documentation</a>.</p>
<h1>Utilisation de ses propres icones 😍</h1>
<p>Voici le point le plus intéressant, utiliser ses propres icônes pour un maximum de flexibilité avec le Node <strong>Custom</strong>.</p>
<p>Si vous êtes à la recherche d’un pack d’icônes <span class="caps">SVG</span> pour réaliser un schéma réseau, vous pouvez tous simplement récupérer ceux de Microsoft Azure qui sont très cool en clonant simplement ce dépôt :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/benc-uk/icon-collection.git
</code></pre></div>
<p>Grâce à Inkscape, vous pouvez convertir les images directement dans une taille et format exploitable pour Diagrams pour un rendu de qualité, par exemple :</p>
<div class="highlight"><pre><span></span><code>inkscape<span class="w"> </span>-w<span class="w"> </span><span class="m">1024</span><span class="w"> </span>-h<span class="w"> </span><span class="m">1024</span><span class="w"> </span>icon-collection/azure-patterns/server.svg<span class="w"> </span>-o<span class="w"> </span>icons/server.png
</code></pre></div>
<p>Maintenant, que nos icônes sont prêtes et stockés dans un dossier (“icons” dans mon cas), il ne reste plus qu’à invoquer tout ça dans son script.</p>
<h1>Mise en application 👷</h1>
<p>Voici maintenant comment initier un script Python avec icônes personnalisées (et ma configuration maison en bonus) :</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Importation des dépendances</span>
from<span class="w"> </span>diagrams<span class="w"> </span>import<span class="w"> </span>Diagram,<span class="w"> </span>Cluster,<span class="w"> </span>Edge
from<span class="w"> </span>diagrams.custom<span class="w"> </span>import<span class="w"> </span>Custom
from<span class="w"> </span>datetime<span class="w"> </span>import<span class="w"> </span>datetime
<span class="nv">today</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>datetime.today<span class="o">()</span>

<span class="c1"># Ici la configuration :</span>
<span class="c1"># Le titre du schéma avec la date de génération,</span>
<span class="c1"># le nom de fichier de sortie avec les formats à générer,</span>
<span class="c1"># la direction d'affichage</span>
<span class="c1"># https://www.graphviz.org/documentation</span>
with<span class="w"> </span>Diagram<span class="o">(</span><span class="s2">"Mon schéma - %s"</span><span class="w"> </span>%<span class="w"> </span>today.strftime<span class="o">(</span><span class="s1">'%d/%m/%Y %H:%M'</span><span class="o">)</span><span class="w"> </span>,<span class="w"> </span><span class="nv">show</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">filename</span><span class="o">=</span><span class="s2">"schema"</span>,<span class="w"> </span><span class="nv">outformat</span><span class="o">=[</span><span class="s2">"png"</span>,<span class="w"> </span><span class="s2">"jpg"</span>,<span class="w"> </span><span class="s2">"svg"</span>,<span class="w"> </span><span class="s2">"pdf"</span>,<span class="w"> </span><span class="s2">"dot"</span><span class="o">]</span>,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span><span class="s2">"TB"</span><span class="o">)</span>:

<span class="w">  </span><span class="c1"># Icones personalisés</span>
<span class="w">  </span><span class="nv">internet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"Serveur"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span><span class="c1"># Groupes</span>
<span class="w">  </span>with<span class="w"> </span>Cluster<span class="o">(</span><span class="s2">"Zone LAN \n VLAN 1 \n DHCP : 192.168.1.1-99"</span><span class="o">)</span>:
<span class="w">      </span><span class="nv">HOME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"192.168.1.0/24"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span>with<span class="w"> </span>Cluster<span class="o">(</span><span class="s2">"Zone DMZ \n VLAN 100 \n DHCP : 192.168.100.1-99"</span><span class="o">)</span>:
<span class="w">    </span><span class="nv">DMZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Custom<span class="o">(</span><span class="s2">"192.168.100.0/24"</span>,<span class="w"> </span><span class="s2">"icons/server.png"</span><span class="o">)</span>

<span class="w">  </span><span class="c1"># Liens</span>
<span class="w">  </span>internet<span class="w"> </span>&gt;&gt;<span class="w"> </span>Edge<span class="o">(</span><span class="nv">color</span><span class="o">=</span><span class="s2">"red"</span>,<span class="w"> </span><span class="nv">label</span><span class="o">=</span><span class="s2">"FTTH"</span>,<span class="w"> </span><span class="nv">style</span><span class="o">=</span><span class="s2">"bold"</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>DMZ
</code></pre></div>
<p>Voici pour le concret, je vous invite à voir le schéma complet que je partage de mon propre réseau domestique à l’adresse <a href="https://network.heuzef.com"><i class="fa fa-map"></i> network.heuzef.com</a>.
Le code Python de mon schéma y est disponible au téléchargement pour vous aider à apprivoiser l’outil.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://heuzef.com/index.html"><i class="fa fa-home"></i> Accueil</a></li>
    <li class="list-inline-item"><a href="https://heuzef.com/categories.html"><i class="fa fa-cubes"></i> Catégories</a></li>
    <li class="list-inline-item"><a href="https://heuzef.com/tags.html"><i class="fa fa-tags"></i> Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Généré avec <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
    / <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  </p>
</div>    </div>
  </footer>

</body>

</html>