# name: Workflow GitHub Action
# Run Workflow when push on main
on:
  push:
    branches:
      - master
jobs:
  execute:
    name: Update
    runs-on: ubuntu-latest
    steps:
    - name: Connecting on remote VM
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        port: ${{ secrets.SSH_PORT }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        script: |
                  sudo -u heuzef bash << 'EOF'
                  # Update, generate and publish the website with Pelican
                  echo "Current user: $(whoami)"
                  echo "Current directory: $(pwd)"
                  echo "Python version: $(python --version)"
                  echo "Pelican version: $(pelican --version)"
                  cd ~/GIT/heuzef_com
                  git pull
                  make html
                  make publish
                  EOF